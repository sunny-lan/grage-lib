{"version":3,"file":"GrageClient.test.js","sourceRoot":"","sources":["../../src/tests/GrageClient.test.ts"],"names":[],"mappings":";;AAAA,oCAAgE;AAEhE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,EAAE;IACf,MAAM,UAAU,GAAG,IAAI,mBAAW,EAAE,CAAA;IACpC,MAAM,UAAU,GAAG,IAAI,mBAAW,EAAE,CAAA;IAEpC,UAAU,CAAC,KAAK,CAAC,iCAAiC,CAAC,CAAA;IACnD,UAAU,CAAC,KAAK,CAAC,iCAAiC,CAAC,CAAA;IAEnD,MAAM,QAAQ,GAAG,gBAAgB,CAAA;IACjC,MAAM,OAAO,GAAG,eAAO,CAAC,YAAY,CAAC,eAAO,CAAC,GAAG,CAAC,EAAE,EAAE,eAAO,CAAC,UAAU,CAAC,GAAG,CAAC,CAAA;IAE5E,UAAU,CAAC,SAAS,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAE;QACjC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;QAChB,IAAI,CAAC;YACD,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;YAC5B,IAAI,EAAE,CAAC;QACX,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACb,IAAI,CAAC,KAAK,CAAC,CAAC;QAChB,CAAC;IACL,CAAC,CAAC,CAAA;IAGF,IAAI,IAAI,GAAG,KAAK,CAAA;IAChB,UAAU,CAAC,eAAe,CAAC,QAAQ,EAAE,MAAM,CAAA,EAAE;QACzC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,yBAAiB,CAAC,MAAM,CAAC,CAAC,CAAA;QAErD,IAAG,IAAI;YAAE,OAAM;QACf,IAAG,MAAM,KAAG,yBAAiB,CAAC,oBAAoB;YAAE,OAAM;QAE1D,UAAU,CAAC,eAAe,CAAC,QAAQ,EAAE,MAAM,CAAA,EAAE;YACzC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,yBAAiB,CAAC,MAAM,CAAC,CAAC,CAAA;YAErD,IAAG,IAAI;gBAAC,OAAM;YACd,IAAG,MAAM,KAAG,yBAAiB,CAAC,oBAAoB;gBAAE,OAAM;YAE1D,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,CAAA;YACxC,IAAI,GAAC,IAAI,CAAA;QACb,CAAC,CAAC,CAAA;IACN,CAAC,CAAC,CAAA;AACN,CAAC,CAAC,CAAA","sourcesContent":["import {esp8266, GrageClient, GrageDeviceStatus} from '../index'\r\n\r\ntest('e2e', done => {\r\n    const recvClient = new GrageClient()\r\n    const sendClient = new GrageClient()\r\n\r\n    recvClient.begin('ws://grage.azurewebsites.net/ws')\r\n    sendClient.begin('ws://grage.azurewebsites.net/ws')\r\n\r\n    const deviceID = 'testdevice1234'\r\n    const testMsg = esp8266.digitalWrite(esp8266.Pin.D1, esp8266.LogicLevel.LOW)\r\n\r\n    recvClient.subscribe(deviceID, msg => {\r\n        console.log(msg)\r\n        try {\r\n            expect(msg).toEqual(testMsg)\r\n            done();\r\n        } catch (error) {\r\n            done(error);\r\n        }\r\n    })\r\n\r\n\r\n    let sent = false\r\n    recvClient.onStatusChanged(deviceID, status=>{\r\n        console.log('recv status', GrageDeviceStatus[status])\r\n\r\n        if(sent) return\r\n        if(status===GrageDeviceStatus.NETWORK_DISCONNECTED) return\r\n\r\n        sendClient.onStatusChanged(deviceID, status=>{\r\n            console.log('send status', GrageDeviceStatus[status])\r\n\r\n            if(sent)return\r\n            if(status===GrageDeviceStatus.NETWORK_DISCONNECTED) return\r\n\r\n            sendClient.send(deviceID, testMsg, true)\r\n            sent=true\r\n        })\r\n    })\r\n})"]}